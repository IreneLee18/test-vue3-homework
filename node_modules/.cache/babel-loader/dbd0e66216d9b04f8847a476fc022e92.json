{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createCommentVNode as _createCommentVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"text-end mt-4\"\n};\nconst _hoisted_2 = {\n  class: \"table mt-4\"\n};\n\nconst _hoisted_3 = /*#__PURE__*/_createElementVNode(\"thead\", null, [/*#__PURE__*/_createElementVNode(\"tr\", null, [/*#__PURE__*/_createElementVNode(\"th\", null, \"名稱\"), /*#__PURE__*/_createElementVNode(\"th\", null, \"代碼\"), /*#__PURE__*/_createElementVNode(\"th\", null, \"折扣百分比\"), /*#__PURE__*/_createElementVNode(\"th\", null, \"到期日\"), /*#__PURE__*/_createElementVNode(\"th\", null, \"是否啟用\"), /*#__PURE__*/_createElementVNode(\"th\", null, \"編輯\")])], -1\n/* HOISTED */\n);\n\nconst _hoisted_4 = {\n  key: 0,\n  class: \"text-success\"\n};\nconst _hoisted_5 = {\n  key: 1,\n  class: \"text-muted\"\n};\nconst _hoisted_6 = {\n  class: \"btn-group\"\n};\nconst _hoisted_7 = [\"onClick\"];\nconst _hoisted_8 = [\"onClick\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_LoadingView = _resolveComponent(\"LoadingView\");\n\n  const _component_coupon_modal = _resolveComponent(\"coupon-modal\");\n\n  const _component_delete_modal = _resolveComponent(\"delete-modal\");\n\n  const _component_pagination = _resolveComponent(\"pagination\");\n\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createElementVNode(\"div\", null, [_createVNode(_component_LoadingView, {\n    active: $data.isLoading\n  }, null, 8\n  /* PROPS */\n  , [\"active\"]), _createElementVNode(\"div\", _hoisted_1, [_createElementVNode(\"button\", {\n    class: \"btn btn-primary\",\n    onClick: _cache[0] || (_cache[0] = $event => $options.openModal(true))\n  }, \" 建立新的優惠券 \")]), _createElementVNode(\"table\", _hoisted_2, [_hoisted_3, _createElementVNode(\"tbody\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.coupons, item => {\n    return _openBlock(), _createElementBlock(\"tr\", {\n      key: item.id\n    }, [_createElementVNode(\"td\", null, _toDisplayString(item.title), 1\n    /* TEXT */\n    ), _createElementVNode(\"td\", null, _toDisplayString(item.code), 1\n    /* TEXT */\n    ), _createElementVNode(\"td\", null, _toDisplayString(item.percent) + \"%\", 1\n    /* TEXT */\n    ), _createElementVNode(\"td\", null, _toDisplayString(_ctx.$filters.date(item.due_date)), 1\n    /* TEXT */\n    ), _createElementVNode(\"td\", null, [item.is_enabled === 1 ? (_openBlock(), _createElementBlock(\"span\", _hoisted_4, \"啟用\")) : (_openBlock(), _createElementBlock(\"span\", _hoisted_5, \"未起用\"))]), _createElementVNode(\"td\", null, [_createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"button\", {\n      class: \"btn btn-outline-primary btn-sm\",\n      onClick: $event => $options.openModal(false, item)\n    }, \"編輯\", 8\n    /* PROPS */\n    , _hoisted_7), _createElementVNode(\"button\", {\n      class: \"btn btn-outline-danger btn-sm\",\n      onClick: $event => $options.openDeleteModal(item)\n    }, \"刪除\", 8\n    /* PROPS */\n    , _hoisted_8)])])]);\n  }), 128\n  /* KEYED_FRAGMENT */\n  ))])])]), _createVNode(_component_coupon_modal, {\n    ref: \"showCouponModal\",\n    coupon: $data.tempCoupon,\n    onAddCoupon: $options.updateCoupon\n  }, null, 8\n  /* PROPS */\n  , [\"coupon\", \"onAddCoupon\"]), _createVNode(_component_delete_modal, {\n    ref: \"showDeleteModal\",\n    item: $data.tempCoupon,\n    onDeleteItem: $options.deleteCoupon\n  }, null, 8\n  /* PROPS */\n  , [\"item\", \"onDeleteItem\"]), _createVNode(_component_pagination, {\n    pages: $data.pagination,\n    onChangePage: $options.getCoupons\n  }, null, 8\n  /* PROPS */\n  , [\"pages\", \"onChangePage\"])], 64\n  /* STABLE_FRAGMENT */\n  );\n}","map":{"version":3,"mappings":"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","names":["class","_createElementVNode","_createVNode","_component_LoadingView","active","$data","onClick","$options","_hoisted_3","_createElementBlock","_Fragment","_renderList","item","key","id","_toDisplayString","title","code","percent","_ctx","date","due_date","is_enabled","_hoisted_7","_hoisted_8","_component_coupon_modal","ref","coupon","onAddCoupon","_component_delete_modal","onDeleteItem","_component_pagination","pages","onChangePage"],"sourceRoot":"","sources":["/Users/irenelee/Desktop/vue-cli-demo/project/test1/src/views/CouponsView.vue"],"sourcesContent":["<template>\n  <div>\n    <LoadingView :active=\"isLoading\"></LoadingView>\n    <div class=\"text-end mt-4\">\n      <button class=\"btn btn-primary\"\n        @click=\"openModal(true)\"\n      >\n        建立新的優惠券\n      </button>\n    </div>\n    <table class=\"table mt-4\">\n      <thead>\n      <tr>\n        <th>名稱</th>\n        <th>代碼</th>\n        <th>折扣百分比</th>\n        <th>到期日</th>\n        <th>是否啟用</th>\n        <th>編輯</th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr v-for=\"item in coupons\" :key=\"item.id\">\n        <td>{{ item.title }}</td>\n        <td>{{ item.code }}</td>\n        <td>{{ item.percent }}%</td>\n        <td>{{ $filters.date(item.due_date) }}</td>\n        <td>\n          <span v-if=\"item.is_enabled === 1\" class=\"text-success\">啟用</span>\n          <span v-else class=\"text-muted\">未起用</span>\n        </td>\n        <td>\n          <div class=\"btn-group\">\n            <button class=\"btn btn-outline-primary btn-sm\"\n            @click=\"openModal(false,item)\"\n            >編輯</button>\n            <button class=\"btn btn-outline-danger btn-sm\"\n            @click=\"openDeleteModal(item)\"\n            >刪除</button>\n          </div>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n  <coupon-modal\n    ref=\"showCouponModal\"\n    :coupon=\"tempCoupon\"\n    @add-coupon=\"updateCoupon\"\n  ></coupon-modal>\n  <delete-modal\n    ref=\"showDeleteModal\"\n    :item=\"tempCoupon\"\n    @delete-item=\"deleteCoupon\"\n  ></delete-modal>\n  <pagination :pages=\"pagination\"\n    @change-page=\"getCoupons\"\n  ></pagination>\n</template>\n\n<script>\nimport couponModal from '../components/CouponModal.vue'\nimport deleteModal from '../components/DeleteModal.vue'\nimport pagination from '../components/PaginationView.vue'\nexport default {\n  components: {\n    couponModal,\n    deleteModal,\n    pagination\n  },\n  data () {\n    return {\n      coupons: [],\n      tempCoupon: {\n      // 原本預設寫在這，但預設被覆蓋掉了，因此索性把這裡刪掉直接在openModal那加入預設。\n      // is_enabled: 0,\n      // title: '',\n      // percent: 100,\n      // code: ''\n      },\n      pagination: {},\n      isNew: false,\n      isLoading: false\n    }\n  },\n  methods: {\n    getCoupons (page = 2) {\n      this.isLoading = true\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupons?page=${page}`\n      // console.log(api)\n      this.$http.get(api)\n        .then((res) => {\n          this.isLoading = false\n          this.coupons = res.data.coupons\n          this.pagination = res.data.pagination\n          console.log(res.data)\n        })\n        .catch((err) => console.log(err.response))\n    },\n    updateCoupon (item) {\n      this.tempCoupon = item\n      console.log('up', this.isNew)\n      // 新增\n      if (this.isNew) {\n        const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon`\n        this.$http.post(api, { data: this.tempCoupon })\n          .then(res => {\n            this.getCoupons()\n            console.log(res, this.tempCoupon)\n          })\n          .catch(err => console.log(err.response))\n        this.$refs.showCouponModal.hideModal()\n      } else {\n        // 編輯\n        const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${this.tempCoupon.id}`\n        this.$http.put(api, { data: this.tempCoupon })\n          .then(res => {\n            this.getCoupons()\n            console.log(res)\n          })\n          .catch(err => console.log(err.response))\n        this.$refs.showCouponModal.hideModal()\n      }\n    },\n    openModal (isNew, item) {\n      this.isNew = isNew\n      console.log(isNew)\n      if (this.isNew) {\n        this.tempCoupon = {\n          // 由於預設被覆蓋掉，所以索性把上面預設刪除，直接在這裡設定預設值\n          title: '',\n          percent: 100,\n          code: '',\n          // 因為在新增時候如果沒點checkbox，讓他先吃到true&false的話，會一直是空值，雖然搞不懂為什麼會這樣，但試著在這裡直接填寫預設，就解決問題了。\n          is_enabled: 0,\n          due_date: new Date().getTime()\n\n          // 日期轉換格式-老師寫法\n          // due_date: new Date().getTime() / 1000\n        }\n      } else {\n        this.tempCoupon = { ...item }\n      }\n      this.$refs.showCouponModal.showModal()\n    },\n    openDeleteModal (item) {\n      this.tempCoupon = { ...item }\n      this.$refs.showDeleteModal.showModal()\n    },\n    deleteCoupon () {\n      // console.log(this.tempCoupon.id)\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${this.tempCoupon.id}`\n      this.$http.delete(api)\n        .then(res => {\n          console.log(res)\n          this.getCoupons()\n        })\n        .catch(err => console.log(err.response))\n      this.$refs.showDeleteModal.hideModal()\n    }\n  },\n  created () {\n    this.getCoupons()\n  }\n}\n</script>\n"]},"metadata":{},"sourceType":"module"}