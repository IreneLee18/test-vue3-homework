{"ast":null,"code":"import couponModal from '../components/CouponModal.vue'; // import deleteModal from '../components/DeleteModal.vue'\n\nexport default {\n  components: {\n    couponModal // deleteModal\n\n  },\n\n  data() {\n    return {\n      coupons: [],\n      tempCoupon: {\n        title: '',\n        is_enabled: 0,\n        percent: 100,\n        code: ''\n      },\n      isNew: false,\n      isLoading: false\n    };\n  },\n\n  methods: {\n    getCoupons() {\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupons`;\n      console.log(api);\n      this.$http.get(api).then(res => {\n        if (res.data.success) {\n          this.isLoading = false;\n          console.log(res.data); // this.products = res.data.products\n          // this.pagination = res.data.pagination\n          // console.log(this.products, this.pagination)\n        }\n      }).catch(err => console.log(err.response));\n    },\n\n    updateCoupon(item) {\n      this.tempCoupon = item; // 新增狀態\n\n      let api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon`;\n      let httpMethod = 'post'; // 編輯狀態\n\n      if (!this.isNew) {\n        api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${item.id}`;\n        httpMethod = 'put';\n      }\n\n      this.$http[httpMethod](api, {\n        data: this.tempCoupon\n      }).then(res => {\n        // console.log(res)\n        this.$refs.showCouponModal.hideModal(); // 製作吐司列表（ 查看回傳成功與否）\n\n        if (res.data.success) {\n          this.getCoupons();\n          this.emitter.emit('pushMsg', {\n            style: 'success',\n            title: '新增優惠卷'\n          });\n        } else {\n          this.emitter.emit('pushMsg', {\n            style: 'danger',\n            title: '更新失敗',\n            content: res.data.message.join('、')\n          });\n        }\n      }).catch(err => console.log(err.response));\n    },\n\n    openModal(isNew, item) {\n      this.isNew = isNew;\n\n      if (this.isNew) {\n        this.tempCoupon = {\n          due_date: new Date().getTime() / 1000\n        };\n      } else {\n        this.tempCoupon = { ...item\n        };\n      }\n\n      this.$refs.showCouponModal.showModal();\n    }\n\n  },\n\n  created() {\n    console.log('hi');\n    this.getCoupons();\n  }\n\n};","map":{"version":3,"mappings":"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","names":["couponModal","components","data","coupons","tempCoupon","title","is_enabled","percent","code","isNew","isLoading","methods","getCoupons","api","process","env","VUE_APP_API","VUE_APP_PATH","console","log","$http","get","then","res","success","catch","err","response","updateCoupon","item","httpMethod","id","$refs","showCouponModal","hideModal","emitter","emit","style","content","message","join","openModal","due_date","Date","getTime","showModal","created"],"sourceRoot":"","sources":["/Users/irenelee/Desktop/vue-cli-demo/project/test1/src/views/CouponsView.vue"],"sourcesContent":["<template>\n  <div>\n    <!-- <Loading :active=\"isLoading\"></Loading> -->\n    <div class=\"text-end mt-4\">\n      <button class=\"btn btn-primary\"\n        @click=\"openModal(true)\"\n      >\n        建立新的優惠券\n      </button>\n    </div>\n    <table class=\"table mt-4\">\n      <thead>\n      <tr>\n        <th>名稱</th>\n        <th>折扣百分比</th>\n        <th>到期日</th>\n        <th>是否啟用</th>\n        <th>編輯</th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr v-for=\"(item, key) in coupons\" :key=\"key\">\n        <td>{{ item.title }}</td>\n        <td>{{ item.percent }}%</td>\n        <td>{{ $filters.date(item.due_date) }}</td>\n        <td>\n          <span v-if=\"item.is_enabled === 1\" class=\"text-success\">啟用</span>\n          <span v-else class=\"text-muted\">未起用</span>\n        </td>\n        <td>\n          <div class=\"btn-group\">\n            <button class=\"btn btn-outline-primary btn-sm\"\n            @click=\"openModal(false,item)\"\n            >編輯</button>\n            <button class=\"btn btn-outline-danger btn-sm\"\n            >刪除</button>\n          </div>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n  <coupon-modal ref=\"showCouponModal\"\n  :coupon=\"tempCoupon\"\n  ></coupon-modal>\n  <!-- <delete-modal></delete-modal> -->\n</template>\n\n<script>\nimport couponModal from '../components/CouponModal.vue'\n// import deleteModal from '../components/DeleteModal.vue'\nexport default {\n  components: {\n    couponModal\n    // deleteModal\n  },\n  data () {\n    return {\n      coupons: [],\n      tempCoupon: {\n        title: '',\n        is_enabled: 0,\n        percent: 100,\n        code: ''\n      },\n      isNew: false,\n      isLoading: false\n    }\n  },\n  methods: {\n    getCoupons () {\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupons`\n      console.log(api)\n      this.$http.get(api)\n        .then((res) => {\n          if (res.data.success) {\n            this.isLoading = false\n            console.log(res.data)\n            // this.products = res.data.products\n            // this.pagination = res.data.pagination\n            // console.log(this.products, this.pagination)\n          }\n        })\n        .catch((err) => console.log(err.response))\n    },\n    updateCoupon (item) {\n      this.tempCoupon = item\n\n      // 新增狀態\n      let api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon`\n      let httpMethod = 'post'\n\n      // 編輯狀態\n      if (!this.isNew) {\n        api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${item.id}`\n        httpMethod = 'put'\n      }\n\n      this.$http[httpMethod](api, { data: this.tempCoupon })\n        .then((res) => {\n          // console.log(res)\n          this.$refs.showCouponModal.hideModal()\n          // 製作吐司列表（ 查看回傳成功與否）\n          if (res.data.success) {\n            this.getCoupons()\n            this.emitter.emit('pushMsg', {\n              style: 'success',\n              title: '新增優惠卷'\n            })\n          } else {\n            this.emitter.emit('pushMsg', {\n              style: 'danger',\n              title: '更新失敗',\n              content: res.data.message.join('、')\n            })\n          }\n        })\n        .catch((err) => console.log(err.response))\n    },\n    openModal (isNew, item) {\n      this.isNew = isNew\n      if (this.isNew) {\n        this.tempCoupon = {\n          due_date: new Date().getTime() / 1000\n        }\n      } else {\n        this.tempCoupon = { ...item }\n      }\n      this.$refs.showCouponModal.showModal()\n    }\n  },\n  created () {\n    console.log('hi')\n    this.getCoupons()\n  }\n}\n</script>\n"]},"metadata":{},"sourceType":"module"}