{"ast":null,"code":"import couponModal from '../components/CouponModal.vue';\nimport deleteModal from '../components/DeleteModal.vue';\nimport pagination from '../components/PaginationView.vue';\nexport default {\n  components: {\n    couponModal,\n    deleteModal,\n    pagination\n  },\n\n  data() {\n    return {\n      coupons: [],\n      tempCoupon: {// 原本預設寫在這，但預設被覆蓋掉了，因此索性把這裡刪掉直接在openModal那加入預設。\n        // is_enabled: 0,\n        // title: '',\n        // percent: 100,\n        // code: ''\n      },\n      pagination: {},\n      isNew: false,\n      isLoading: false\n    };\n  },\n\n  methods: {\n    getCoupons(page = 1) {\n      this.isLoading = true;\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupons?page=${page}`; // console.log(api)\n\n      this.$http.get(api).then(res => {\n        this.isLoading = false;\n        this.coupons = res.data.coupons;\n        this.pagination = res.data.pagination;\n        console.log(res.data);\n      }).catch(err => console.log(err.response));\n    },\n\n    updateCoupon(item) {\n      this.tempCoupon = item;\n      console.log('up', this.isNew); // 新增\n\n      if (this.isNew) {\n        const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon`;\n        this.$http.post(api, {\n          data: this.tempCoupon\n        }).then(res => {\n          this.getCoupons();\n          console.log(res, this.tempCoupon);\n        }).catch(err => console.log(err.response));\n        this.$refs.showCouponModal.hideModal();\n      } else {\n        // 編輯\n        const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${this.tempCoupon.id}`;\n        this.$http.put(api, {\n          data: this.tempCoupon\n        }).then(res => {\n          this.getCoupons();\n          console.log(res);\n        }).catch(err => console.log(err.response));\n        this.$refs.showCouponModal.hideModal();\n      }\n    },\n\n    openModal(isNew, item) {\n      this.isNew = isNew;\n      console.log(isNew);\n\n      if (this.isNew) {\n        this.tempCoupon = {\n          // 由於預設被覆蓋掉，所以索性把上面預設刪除，直接在這裡設定預設值\n          title: '',\n          percent: 100,\n          code: '',\n          // 因為在新增時候如果沒點checkbox，讓他先吃到true&false的話，會一直是空值，雖然搞不懂為什麼會這樣，但試著在這裡直接填寫預設，就解決問題了。\n          is_enabled: 0,\n          due_date: new Date().getTime() // 日期轉換格式-老師寫法\n          // due_date: new Date().getTime() / 1000\n\n        };\n      } else {\n        this.tempCoupon = { ...item\n        };\n      }\n\n      this.$refs.showCouponModal.showModal();\n    },\n\n    openDeleteModal(item) {\n      this.tempCoupon = { ...item\n      };\n      this.$refs.showDeleteModal.showModal();\n    },\n\n    deleteCoupon() {\n      // console.log(this.tempCoupon.id)\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${this.tempCoupon.id}`;\n      this.$http.delete(api).then(res => {\n        console.log(res);\n        this.getCoupons();\n      }).catch(err => console.log(err.response));\n      this.$refs.showDeleteModal.hideModal();\n    }\n\n  },\n\n  created() {\n    this.getCoupons();\n  }\n\n};","map":{"version":3,"mappings":"AA6DA,OAAOA,WAAP,MAAwB,+BAAxB;AACA,OAAOC,WAAP,MAAwB,+BAAxB;AACA,OAAOC,UAAP,MAAuB,kCAAvB;AACA,eAAe;EACbC,UAAU,EAAE;IACVH,WADU;IAEVC,WAFU;IAGVC;EAHU,CADC;;EAMbE,IAAG,GAAK;IACN,OAAO;MACLC,OAAO,EAAE,EADJ;MAELC,UAAU,EAAE,CACZ;QACA;QACA;QACA;QACA;MALY,CAFP;MASLJ,UAAU,EAAE,EATP;MAULK,KAAK,EAAE,KAVF;MAWLC,SAAS,EAAE;IAXN,CAAP;EAaD,CApBY;;EAqBbC,OAAO,EAAE;IACPC,UAAS,CAAGC,IAAG,GAAI,CAAV,EAAa;MACpB,KAAKH,SAAL,GAAiB,IAAjB;MACA,MAAMI,GAAE,GAAK,GAAEC,OAAO,CAACC,GAAR,CAAYC,WAAY,OAAMF,OAAO,CAACC,GAAR,CAAYE,YAAa,uBAAsBL,IAAK,EAAjG,CAFoB,CAGpB;;MACA,KAAKM,KAAL,CAAWC,GAAX,CAAeN,GAAf,EACGO,IADH,CACSC,GAAD,IAAS;QACb,KAAKZ,SAAL,GAAiB,KAAjB;QACA,KAAKH,OAAL,GAAee,GAAG,CAAChB,IAAJ,CAASC,OAAxB;QACA,KAAKH,UAAL,GAAkBkB,GAAG,CAAChB,IAAJ,CAASF,UAA3B;QACAmB,OAAO,CAACC,GAAR,CAAYF,GAAG,CAAChB,IAAhB;MACD,CANH,EAOGmB,KAPH,CAOUC,GAAD,IAASH,OAAO,CAACC,GAAR,CAAYE,GAAG,CAACC,QAAhB,CAPlB;IAQD,CAbM;;IAcPC,YAAW,CAAGC,IAAH,EAAS;MAClB,KAAKrB,UAAL,GAAkBqB,IAAlB;MACAN,OAAO,CAACC,GAAR,CAAY,IAAZ,EAAkB,KAAKf,KAAvB,EAFkB,CAGlB;;MACA,IAAI,KAAKA,KAAT,EAAgB;QACd,MAAMK,GAAE,GAAK,GAAEC,OAAO,CAACC,GAAR,CAAYC,WAAY,OAAMF,OAAO,CAACC,GAAR,CAAYE,YAAa,eAAtE;QACA,KAAKC,KAAL,CAAWW,IAAX,CAAgBhB,GAAhB,EAAqB;UAAER,IAAI,EAAE,KAAKE;QAAb,CAArB,EACGa,IADH,CACQC,GAAE,IAAK;UACX,KAAKV,UAAL;UACAW,OAAO,CAACC,GAAR,CAAYF,GAAZ,EAAiB,KAAKd,UAAtB;QACD,CAJH,EAKGiB,KALH,CAKSC,GAAE,IAAKH,OAAO,CAACC,GAAR,CAAYE,GAAG,CAACC,QAAhB,CALhB;QAMA,KAAKI,KAAL,CAAWC,eAAX,CAA2BC,SAA3B;MACF,CATA,MASO;QACL;QACA,MAAMnB,GAAE,GAAK,GAAEC,OAAO,CAACC,GAAR,CAAYC,WAAY,OAAMF,OAAO,CAACC,GAAR,CAAYE,YAAa,iBAAgB,KAAKV,UAAL,CAAgB0B,EAAG,EAAzG;QACA,KAAKf,KAAL,CAAWgB,GAAX,CAAerB,GAAf,EAAoB;UAAER,IAAI,EAAE,KAAKE;QAAb,CAApB,EACGa,IADH,CACQC,GAAE,IAAK;UACX,KAAKV,UAAL;UACAW,OAAO,CAACC,GAAR,CAAYF,GAAZ;QACD,CAJH,EAKGG,KALH,CAKSC,GAAE,IAAKH,OAAO,CAACC,GAAR,CAAYE,GAAG,CAACC,QAAhB,CALhB;QAMA,KAAKI,KAAL,CAAWC,eAAX,CAA2BC,SAA3B;MACF;IACD,CAtCM;;IAuCPG,SAAQ,CAAG3B,KAAH,EAAUoB,IAAV,EAAgB;MACtB,KAAKpB,KAAL,GAAaA,KAAb;MACAc,OAAO,CAACC,GAAR,CAAYf,KAAZ;;MACA,IAAI,KAAKA,KAAT,EAAgB;QACd,KAAKD,UAAL,GAAkB;UAChB;UACA6B,KAAK,EAAE,EAFS;UAGhBC,OAAO,EAAE,GAHO;UAIhBC,IAAI,EAAE,EAJU;UAKhB;UACAC,UAAU,EAAE,CANI;UAOhBC,QAAQ,EAAE,IAAIC,IAAJ,GAAWC,OAAX,EAPM,CAShB;UACA;;QAVgB,CAAlB;MAYF,CAbA,MAaO;QACL,KAAKnC,UAAL,GAAkB,EAAE,GAAGqB;QAAL,CAAlB;MACF;;MACA,KAAKE,KAAL,CAAWC,eAAX,CAA2BY,SAA3B;IACD,CA3DM;;IA4DPC,eAAc,CAAGhB,IAAH,EAAS;MACrB,KAAKrB,UAAL,GAAkB,EAAE,GAAGqB;MAAL,CAAlB;MACA,KAAKE,KAAL,CAAWe,eAAX,CAA2BF,SAA3B;IACD,CA/DM;;IAgEPG,YAAW,GAAK;MACd;MACA,MAAMjC,GAAE,GAAK,GAAEC,OAAO,CAACC,GAAR,CAAYC,WAAY,OAAMF,OAAO,CAACC,GAAR,CAAYE,YAAa,iBAAgB,KAAKV,UAAL,CAAgB0B,EAAG,EAAzG;MACA,KAAKf,KAAL,CAAW6B,MAAX,CAAkBlC,GAAlB,EACGO,IADH,CACQC,GAAE,IAAK;QACXC,OAAO,CAACC,GAAR,CAAYF,GAAZ;QACA,KAAKV,UAAL;MACD,CAJH,EAKGa,KALH,CAKSC,GAAE,IAAKH,OAAO,CAACC,GAAR,CAAYE,GAAG,CAACC,QAAhB,CALhB;MAMA,KAAKI,KAAL,CAAWe,eAAX,CAA2Bb,SAA3B;IACF;;EA1EO,CArBI;;EAiGbgB,OAAM,GAAK;IACT,KAAKrC,UAAL;EACF;;AAnGa,CAAf","names":["couponModal","deleteModal","pagination","components","data","coupons","tempCoupon","isNew","isLoading","methods","getCoupons","page","api","process","env","VUE_APP_API","VUE_APP_PATH","$http","get","then","res","console","log","catch","err","response","updateCoupon","item","post","$refs","showCouponModal","hideModal","id","put","openModal","title","percent","code","is_enabled","due_date","Date","getTime","showModal","openDeleteModal","showDeleteModal","deleteCoupon","delete","created"],"sourceRoot":"","sources":["/Users/irenelee/Desktop/vue-cli-demo/project/test1/src/views/CouponsView.vue"],"sourcesContent":["<template>\n  <div>\n    <LoadingView :active=\"isLoading\"></LoadingView>\n    <div class=\"text-end mt-4\">\n      <button class=\"btn btn-primary\"\n        @click=\"openModal(true)\"\n      >\n        建立新的優惠券\n      </button>\n    </div>\n    <table class=\"table mt-4\">\n      <thead>\n      <tr>\n        <th>名稱</th>\n        <th>代碼</th>\n        <th>折扣百分比</th>\n        <th>到期日</th>\n        <th>是否啟用</th>\n        <th>編輯</th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr v-for=\"item in coupons\" :key=\"item.id\">\n        <td>{{ item.title }}</td>\n        <td>{{ item.code }}</td>\n        <td>{{ item.percent }}%</td>\n        <td>{{ $filters.date(item.due_date) }}</td>\n        <td>\n          <span v-if=\"item.is_enabled === 1\" class=\"text-success\">啟用</span>\n          <span v-else class=\"text-muted\">未起用</span>\n        </td>\n        <td>\n          <div class=\"btn-group\">\n            <button class=\"btn btn-outline-primary btn-sm\"\n            @click=\"openModal(false,item)\"\n            >編輯</button>\n            <button class=\"btn btn-outline-danger btn-sm\"\n            @click=\"openDeleteModal(item)\"\n            >刪除</button>\n          </div>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n  <coupon-modal\n    ref=\"showCouponModal\"\n    :coupon=\"tempCoupon\"\n    @add-coupon=\"updateCoupon\"\n  ></coupon-modal>\n  <delete-modal\n    ref=\"showDeleteModal\"\n    :item=\"tempCoupon\"\n    @delete-item=\"deleteCoupon\"\n  ></delete-modal>\n  <pagination :pages=\"pagination\"\n    @change-page=\"getCoupons\"\n  ></pagination>\n</template>\n\n<script>\nimport couponModal from '../components/CouponModal.vue'\nimport deleteModal from '../components/DeleteModal.vue'\nimport pagination from '../components/PaginationView.vue'\nexport default {\n  components: {\n    couponModal,\n    deleteModal,\n    pagination\n  },\n  data () {\n    return {\n      coupons: [],\n      tempCoupon: {\n      // 原本預設寫在這，但預設被覆蓋掉了，因此索性把這裡刪掉直接在openModal那加入預設。\n      // is_enabled: 0,\n      // title: '',\n      // percent: 100,\n      // code: ''\n      },\n      pagination: {},\n      isNew: false,\n      isLoading: false\n    }\n  },\n  methods: {\n    getCoupons (page = 1) {\n      this.isLoading = true\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupons?page=${page}`\n      // console.log(api)\n      this.$http.get(api)\n        .then((res) => {\n          this.isLoading = false\n          this.coupons = res.data.coupons\n          this.pagination = res.data.pagination\n          console.log(res.data)\n        })\n        .catch((err) => console.log(err.response))\n    },\n    updateCoupon (item) {\n      this.tempCoupon = item\n      console.log('up', this.isNew)\n      // 新增\n      if (this.isNew) {\n        const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon`\n        this.$http.post(api, { data: this.tempCoupon })\n          .then(res => {\n            this.getCoupons()\n            console.log(res, this.tempCoupon)\n          })\n          .catch(err => console.log(err.response))\n        this.$refs.showCouponModal.hideModal()\n      } else {\n        // 編輯\n        const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${this.tempCoupon.id}`\n        this.$http.put(api, { data: this.tempCoupon })\n          .then(res => {\n            this.getCoupons()\n            console.log(res)\n          })\n          .catch(err => console.log(err.response))\n        this.$refs.showCouponModal.hideModal()\n      }\n    },\n    openModal (isNew, item) {\n      this.isNew = isNew\n      console.log(isNew)\n      if (this.isNew) {\n        this.tempCoupon = {\n          // 由於預設被覆蓋掉，所以索性把上面預設刪除，直接在這裡設定預設值\n          title: '',\n          percent: 100,\n          code: '',\n          // 因為在新增時候如果沒點checkbox，讓他先吃到true&false的話，會一直是空值，雖然搞不懂為什麼會這樣，但試著在這裡直接填寫預設，就解決問題了。\n          is_enabled: 0,\n          due_date: new Date().getTime()\n\n          // 日期轉換格式-老師寫法\n          // due_date: new Date().getTime() / 1000\n        }\n      } else {\n        this.tempCoupon = { ...item }\n      }\n      this.$refs.showCouponModal.showModal()\n    },\n    openDeleteModal (item) {\n      this.tempCoupon = { ...item }\n      this.$refs.showDeleteModal.showModal()\n    },\n    deleteCoupon () {\n      // console.log(this.tempCoupon.id)\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${this.tempCoupon.id}`\n      this.$http.delete(api)\n        .then(res => {\n          console.log(res)\n          this.getCoupons()\n        })\n        .catch(err => console.log(err.response))\n      this.$refs.showDeleteModal.hideModal()\n    }\n  },\n  created () {\n    this.getCoupons()\n  }\n}\n</script>\n"]},"metadata":{},"sourceType":"module"}